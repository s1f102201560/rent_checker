{% extends "app/base.html" %}
{% load static %}
{% load custom_filters %}

{% block main %}
<div class="mt-20 px-4 sm:px-6 lg:px-8 bg-white text-gray-500 font-semibold">
  <h2 class="text-2xl text-gray-700 mb-8 text-center">{{ consultation.title }}</h2>
  
  <div class="max-w-lg mx-auto space-y-6">
    <div>
      <span class="font-semibold">チャットURL：</span>
      <a href="{% url 'chat' consultation.room_link|extract_last_segment %}" 
         onclick="navigateToChat('{{ consultation.room_link|extract_last_segment }}')" 
         class="text-blue-400 hover:underline break-all">
        {{ consultation.room_link }}
      </a>
    </div>

    <div>
      <span class="font-semibold">書類：</span>
      {% if consultation.file %}
        <img class="mt-2 max-w-full h-auto border border-gray-300 rounded" src="{{ consultation.file.url }}" alt="相談資料" />
      {% else %}
        <p class="text-gray-600">アップロードされていません。</p>
      {% endif %}
    </div>

    <div>
      <span class="font-semibold">質問事項：</span>
      <p class="text-gray-600 mt-1 break-words">{{ consultation.checklist }}</p>
    </div>

    <div>
      <span class="font-semibold">投稿日：</span>
      <p class="text-gray-600 mt-1">{{ consultation.created_at }}</p>
    </div>

    <div class="text-right">
      <a href="{% url 'consultation_edit' consultation.id %}" 
         class="inline-block font-semibold px-3 py-2 text-white bg-yellow-200 border-2 border-yellow-200 rounded-full hover:text-yellow-200 hover:bg-white">
        編集
      </a>
    </div>
  </div>
</div>

<script>
  function navigateToChat(roomName) {
    const ws = new WebSocket('ws://' + window.location.host + '/ws/consultation/' + roomName + '/');
    window.location.href = '/consultation/' + roomName + '/';
  }
</script>
{% endblock main %}

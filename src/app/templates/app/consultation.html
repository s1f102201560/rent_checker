{% extends "app/base.html" %}
{% load static %}

{% block main %}
  <div>
    <p>あなたの相談を共有しよう！</p>
    <a href="{% url "consultation_new" %}">新しい相談を共有する</a>
  </div>

  <h2>相談一覧</h2>
  {% if consultations %}
    <table class="table">
      <thead>
        <tr>
          <th>相談名</th>
          <th>チャットURL</th>
          <th>書類</th>
          <th>質問項目</th>
          <th>投稿者</th>
          <th>投稿日</th>
          <th></th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for consultation in consultations %}
          <tr>
            <th>{{ consultation.title }}</th>
            <th>
              <a href="#" onclick="navigateToChat('{{ consultation.room_link }}')">
                {{ consultation.room_link }}
              </a>
            </th>
            <th>{{ consultation.file }}</th>
            <th>{{ consultation.checklist }}</th>
            <th>{{ consultation.created_at }}</th>
            <th><a href="{% url "consultation_detail" consultation.id %}">詳細</a></th>
            <th><a href="{% url "consultation_edit" consultation.id %}">編集</a></th>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>過去にアップロードした書類ははありません。</p>
  {% endif %}
  <script>
    function navigateToChat(roomLink) {
      const roomName = roomLink.split('/').filter(Boolean).pop();
      const ws = new WebSocket('ws://' + window.location.host + '/ws/consultation/chat/' + roomName + '/');
      window.location.href = '/consultation/chat/' + roomName + '/';
    }
  </script>
{% endblock main %}
